<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Import CSV → Notion | Gestione Contatti</title>
    <style>
        :root {
            --primary: #5865F2;
            --primary-dark: #4752C4;
            --success: #3BA55C;
            --warning: #FAA61A;
            --danger: #ED4245;
            --bg: #f0f2f5;
            --card: #ffffff;
            --text: #2c3e50;
            --text-light: #6c757d;
            --border: #dee2e6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header .subtitle {
            opacity: 0.9;
            margin-top: 5px;
            font-size: 14px;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            padding: 0 20px;
        }

        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .step::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50%;
            width: 100%;
            height: 2px;
            background: var(--border);
            z-index: -1;
        }

        .step:last-child::after {
            display: none;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid var(--border);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .step.active .step-circle {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .step.completed .step-circle {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .step-label {
            font-size: 12px;
            color: var(--text-light);
        }

        .step.active .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        .card {
            background: var(--card);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(88, 101, 242, 0.05);
        }

        .upload-area.dragging {
            border-color: var(--primary);
            background: rgba(88, 101, 242, 0.1);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-secondary {
            background: var(--text-light);
            color: white;
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg);
            font-weight: 600;
            font-size: 14px;
            color: var(--text-light);
        }

        tr:hover {
            background: rgba(88, 101, 242, 0.05);
        }

        .mapping-select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 14px;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(59, 165, 92, 0.1);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(250, 166, 26, 0.1);
            color: var(--warning);
        }

        .badge-danger {
            background: rgba(237, 66, 69, 0.1);
            color: var(--danger);
        }

        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 30px;
            background: var(--bg);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-dark));
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin: 20px 0;
        }

        .stat-card {
            background: var(--bg);
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 14px;
            color: var(--text-light);
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin: 20px 0;
            border: 1px solid var(--border);
        }

        .log-entry {
            margin: 4px 0;
        }

        .log-time {
            color: #858585;
        }

        .log-success {
            color: #4ec9b0;
        }

        .log-error {
            color: #f48771;
        }

        .log-warning {
            color: #dcdcaa;
        }

        .hidden {
            display: none !important;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-info {
            background: rgba(88, 101, 242, 0.1);
            color: var(--primary);
            border: 1px solid rgba(88, 101, 242, 0.3);
        }

        .alert-success {
            background: rgba(59, 165, 92, 0.1);
            color: var(--success);
            border: 1px solid rgba(59, 165, 92, 0.3);
        }

        .alert-danger {
            background: rgba(237, 66, 69, 0.1);
            color: var(--danger);
            border: 1px solid rgba(237, 66, 69, 0.3);
        }

        .spinner {
            border: 3px solid var(--bg);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .btn-large {
            font-size: 18px;
            padding: 15px 30px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(88, 101, 242, 0.4);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 8px 25px rgba(88, 101, 242, 0.6);
            }
            100% {
                transform: scale(1);
                box-shadow: 0 5px 15px rgba(88, 101, 242, 0.4);
            }
        }
        
        .correction-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 12px;
        }

        .correction-item {
            padding: 8px;
            margin: 4px 0;
            background: var(--bg);
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .arrow {
            color: var(--text-light);
            margin: 0 8px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>
                📊 Import CSV → Notion
            </h1>
            <div class="subtitle">Importa contatti dal tuo CSV direttamente in Notion</div>
        </div>
    </div>

    <div class="container">
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">Upload CSV</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Mapping Colonne</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">Importazione</div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">✓</div>
                <div class="step-label">Completato</div>
            </div>
        </div>

        <!-- Step 1: Upload -->
        <div id="uploadSection" class="card">
            <h2 class="card-title">
                📁 Carica il tuo file CSV
            </h2>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📤</div>
                <p><strong>Trascina qui il tuo file CSV</strong></p>
                <p class="text-light">oppure</p>
                <button class="btn btn-primary">Seleziona File</button>
                <input type="file" id="fileInput" accept=".csv" style="display: none;">
            </div>

            <div id="fileInfo" class="alert alert-info hidden">
                <span id="fileName"></span>
                <button class="btn btn-outline" onclick="resetUpload()">Cambia File</button>
            </div>
            
            <div id="parseSection" class="hidden" style="margin-top: 20px;">
                <div class="alert alert-success">
                    ✅ File caricato correttamente!
                    <div id="csvInfo" style="margin-top: 10px;"></div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary btn-large" onclick="proceedToMapping()">
                        ▶️ Procedi con il Mapping
                    </button>
                </div>
            </div>
            
            <!-- Log Section sempre visibile -->
            <div style="margin-top: 20px;">
                <h3 style="font-size: 14px; color: var(--text-light); margin-bottom: 10px;">📋 Log Operazioni</h3>
                <div class="log-container" id="mainLogContainer" style="max-height: 200px;">
                    <!-- Log entries added dynamically -->
                </div>
            </div>
        </div>

        <!-- Step 2: Mapping -->
        <div id="mappingSection" class="card hidden">
            <h2 class="card-title">
                🔗 Mapping delle Colonne
            </h2>
            
            <div class="alert alert-info">
                <span>📌</span>
                Associa le colonne del CSV ai campi di Notion. <strong>Email primaria è obbligatoria!</strong>
            </div>
            
            <div id="emailWarning" class="alert alert-danger hidden">
                <span>⚠️</span>
                <strong>Attenzione:</strong> Il campo "Email primaria" è obbligatorio per l'importazione!
            </div>

            <div class="table-container">
                <table id="mappingTable">
                    <thead>
                        <tr>
                            <th>Colonna CSV</th>
                            <th>Info</th>
                            <th>Campo Notion</th>
                        </tr>
                    </thead>
                    <tbody id="mappingBody">
                        <!-- Populated dynamically -->
                    </tbody>
                </table>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="goToStep(1)">← Indietro</button>
                <button class="btn btn-primary" id="importButton" onclick="startImport()" disabled>
                    Avvia Importazione →
                </button>
            </div>
        </div>

        <!-- Step 3: Import Progress -->
        <div id="importSection" class="card hidden">
            <h2 class="card-title">
                ⚡ Importazione in Corso
            </h2>

            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%">
                        0%
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Totale Righe</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statSuccess" style="color: var(--success)">0</div>
                    <div class="stat-label">Importati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statErrors" style="color: var(--danger)">0</div>
                    <div class="stat-label">Errori</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="statTime">0s</div>
                    <div class="stat-label">Tempo</div>
                </div>
            </div>

            <div class="log-container" id="logContainer">
                <!-- Log entries added dynamically -->
            </div>
        </div>

        <!-- Step 4: Results -->
        <div id="resultsSection" class="card hidden">
            <h2 class="card-title">
                ✅ Importazione Completata
            </h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="finalSuccess" style="color: var(--success)">0</div>
                    <div class="stat-label">Contatti Importati</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalErrors" style="color: var(--danger)">0</div>
                    <div class="stat-label">Errori</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalCorrected" style="color: var(--primary)">0</div>
                    <div class="stat-label">Comuni Corretti</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalAI" style="color: #9333ea">0</div>
                    <div class="stat-label">Correzioni AI</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="finalNotFound" style="color: var(--warning)">0</div>
                    <div class="stat-label">Comuni Non Trovati</div>
                </div>
            </div>

            <div id="correctionDetails" class="hidden">
                <h3 style="margin: 20px 0 10px;">📍 Comuni Corretti Automaticamente</h3>
                <div class="correction-list" id="correctionList">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div id="aiCorrectionDetails" class="hidden">
                <h3 style="margin: 20px 0 10px;">🤖 Correzioni con Intelligenza Artificiale (GPT-4o-mini)</h3>
                <div class="correction-list" id="aiCorrectionList" style="background: linear-gradient(135deg, rgba(147, 51, 234, 0.05) 0%, rgba(88, 101, 242, 0.05) 100%); border: 1px solid rgba(147, 51, 234, 0.3);">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div id="notFoundDetails" class="hidden">
                <h3 style="margin: 20px 0 10px;">⚠️ Comuni Non Trovati</h3>
                <div class="correction-list" id="notFoundList">
                    <!-- Populated dynamically -->
                </div>
            </div>

            <div id="skippedContactsDetails" class="hidden">
                <h3 style="margin: 20px 0 10px;">📋 Contatti Non Importati - Dettaglio Completo</h3>
                <div class="table-container" style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px;">
                    <table id="skippedContactsTable">
                        <thead>
                            <tr id="skippedContactsHeader">
                                <!-- Populated dynamically -->
                            </tr>
                        </thead>
                        <tbody id="skippedContactsBody">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
                <div style="margin-top: 10px;">
                    <button class="btn btn-outline" onclick="exportSkippedContacts()">
                        📥 Esporta CSV Contatti Non Importati
                    </button>
                </div>
            </div>

            <div id="errorDetails" class="hidden">
                <h3 style="margin: 20px 0 10px;">❌ Errori di Importazione</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Riga</th>
                                <th>Errore</th>
                            </tr>
                        </thead>
                        <tbody id="errorList">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div style="margin-top: 30px; text-align: center;">
                <button class="btn btn-primary" onclick="location.reload()">
                    🔄 Nuova Importazione
                </button>
                <button class="btn btn-success" onclick="window.open('https://www.notion.so/', '_blank')">
                    📂 Apri Notion
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== VARIABILI GLOBALI =====
        let csvFullText = null;
        let csvHeaders = [];
        let csvRowCount = 0;
        let currentMapping = {};
        let importStartTime = null;

        // ===== INIZIALIZZAZIONE =====
        document.addEventListener('DOMContentLoaded', () => {
            console.log('[INIT] Inizializzazione applicazione...');
            
            // Previeni errori di estensioni browser
            try {
                setupUploadArea();
                testConnection();
                addLog('🚀 Applicazione pronta', 'success');
            } catch (error) {
                console.error('[INIT] Errore inizializzazione:', error);
                addLog('⚠️ Errore inizializzazione: ' + error.message, 'error');
            }
        });

        // ===== TEST CONNESSIONE =====
        async function testConnection() {
            try {
                addLog('🔌 Test connessione server...', 'info');
                
                const response = await fetch('http://localhost:8000/test-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    addLog(`✅ Connesso a Notion come: ${data.user || 'Utente'}`, 'success');
                } else {
                    addLog('⚠️ Connessione fallita: ' + (data.error || 'Errore sconosciuto'), 'error');
                }
                
            } catch (error) {
                console.error('[TEST] Errore connessione:', error);
                
                if (error.message.includes('net::ERR_CONNECTION_REFUSED') || 
                    error.message.includes('net::ERR_INVALID_HTTP_RESPONSE')) {
                    addLog('⚠️ Server non in esecuzione. Avvia: python3 server.py', 'error');
                    showAlert('⚠️ Server non raggiungibile. Assicurati che sia avviato con: python3 server.py', 'danger');
                } else {
                    addLog('⚠️ Errore connessione: ' + error.message, 'error');
                    showAlert('⚠️ Errore di connessione: ' + error.message, 'danger');
                }
            }
        }

        // ===== SETUP UPLOAD AREA =====
        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            if (!uploadArea || !fileInput) {
                console.error('[SETUP] Elementi upload non trovati');
                return;
            }
            
            // Click to upload
            uploadArea.addEventListener('click', () => fileInput.click());
            
            // File selection
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
            
            // Drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragging');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragging');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragging');
                
                if (e.dataTransfer.files.length > 0) {
                    handleFile(e.dataTransfer.files[0]);
                }
            });
            
            console.log('[SETUP] Upload area configurata');
        }

        // ===== GESTIONE FILE =====
        async function handleFile(file) {
            try {
                console.log('[FILE] File selezionato:', file.name, file.size);
                
                if (!file.name.toLowerCase().endsWith('.csv')) {
                    throw new Error('Per favore seleziona un file CSV');
                }
                
                addLog(`📁 File selezionato: ${file.name}`, 'info');
                
                // Show file info
                const fileNameEl = document.getElementById('fileName');
                const fileInfoEl = document.getElementById('fileInfo');
                const uploadAreaEl = document.getElementById('uploadArea');
                
                if (fileNameEl) fileNameEl.textContent = `📄 ${file.name} (${formatFileSize(file.size)})`;
                if (fileInfoEl) fileInfoEl.classList.remove('hidden');
                if (uploadAreaEl) uploadAreaEl.classList.add('hidden');
                
                addLog(`📏 Dimensione file: ${formatFileSize(file.size)}`, 'info');
                addLog('⏳ Analisi headers CSV...', 'info');
                
                // Read file as text to extract headers
                const text = await readFileAsText(file);
                const normalizedText = text.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
                
                console.log('[FILE] File letto, lunghezza:', normalizedText.length);
                
                // Extract headers (first line)
                const lines = normalizedText.split('\n');
                const firstLine = lines[0];
                
                if (!firstLine || firstLine.trim() === '') {
                    throw new Error('Il file CSV è vuoto o non valido');
                }
                
                const headers = parseCSVLine(firstLine);
                console.log('[FILE] Headers estratti:', headers);
                
                if (headers.length === 0) {
                    throw new Error('Nessun header trovato nel CSV');
                }
                
                // Count total rows (exclude empty lines and header)
                const dataLines = lines.slice(1).filter(line => line.trim());
                const totalRows = dataLines.length;
                
                if (totalRows === 0) {
                    throw new Error('Il CSV non contiene dati (solo headers)');
                }
                
                addLog('✅ Headers estratti correttamente', 'success');
                addLog(`📊 ${headers.length} colonne trovate`, 'info');
                addLog(`📈 ${totalRows} righe di dati`, 'info');
                
                // Store data globally
                csvFullText = normalizedText;
                csvHeaders = headers.filter(h => h && typeof h === 'string' && h.trim()); // Filtra headers validi
                csvRowCount = totalRows;
                
                console.log('[FILE] Dati salvati - Headers validati:', csvHeaders.length);
                
                // Show mapping interface
                showQuickMapping(csvHeaders, totalRows);
                
            } catch (error) {
                console.error('[FILE] Errore:', error);
                addLog('❌ Errore: ' + error.message, 'error');
                showAlert('Errore: ' + error.message, 'danger');
                resetUpload();
            }
        }
        
        // ===== UTILITY FUNCTIONS =====
        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(new Error('Errore lettura file'));
                reader.readAsText(file, 'UTF-8');
            });
        }
        
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                const nextChar = line[i + 1];
                
                if (char === '"') {
                    if (inQuotes && nextChar === '"') {
                        current += '"';
                        i++; // skip next quote
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            // Add last field
            if (current || line.endsWith(',')) {
                result.push(current.trim());
            }
            
            return result.filter(field => field !== undefined);
        }
        
        // ===== MAPPING =====
        function showQuickMapping(headers, totalRows) {
            try {
                // Update CSV info
                const csvInfoEl = document.getElementById('csvInfo');
                if (csvInfoEl) {
                    csvInfoEl.innerHTML = `
                        <strong>Righe:</strong> ${totalRows} | 
                        <strong>Colonne:</strong> ${headers.length}
                    `;
                }
                
                // Auto-suggest mapping
                currentMapping = suggestMapping(headers);
                
                // Log suggested mappings
                const mappingCount = Object.keys(currentMapping).length;
                if (mappingCount > 0) {
                    addLog(`🎯 ${mappingCount} campi riconosciuti automaticamente:`, 'success');
                    for (const [field, column] of Object.entries(currentMapping)) {
                        if (column && field) {
                            addLog(`  • ${column} → ${field}`, 'info');
                        }
                    }
                }
                
                // Show proceed button
                const parseSectionEl = document.getElementById('parseSection');
                if (parseSectionEl) parseSectionEl.classList.remove('hidden');
                
            } catch (error) {
                console.error('[MAPPING] Errore:', error);
                addLog('❌ Errore mapping: ' + error.message, 'error');
            }
        }
        
        function suggestMapping(headers) {
            const suggested = {};
            
            const patterns = {
                'email': /email|mail|pec|contatto|e-mail/i,
                'nome': /nome|cognome|referente|responsabile|name|denominazione/i,
                'comune': /comune|città|city|località|municipio|citta/i,
                'indirizzo': /indirizzo|via|address|sede|ubicazione/i,
                'telefono': /^telefono|^tel(?!.*cell)|phone(?!.*cell)|fisso/i,
                'cellulare': /cell|mobile|portatile|smartphone/i,
                'sito': /sito|web|url|website|www/i,
                'tipo': /tipo|categoria|settore|type|tipologia/i,
                'carica': /carica|ruolo|posizione|qualifica|titolo|funzione/i
            };
            
            headers.forEach(header => {
                // Check if header is valid
                if (!header || typeof header !== 'string') {
                    console.warn('[MAPPING] Header non valido:', header);
                    return;
                }
                
                const headerLower = header.toLowerCase().trim();
                
                for (const [field, pattern] of Object.entries(patterns)) {
                    if (pattern.test(headerLower)) {
                        // Handle multiple email fields
                        if (field === 'email') {
                            if (!suggested.email) {
                                suggested.email = header;
                            } else if (headerLower.includes('2') || headerLower.includes('secondar')) {
                                suggested.email2 = header;
                            } else if (headerLower.includes('3') || headerLower.includes('terz')) {
                                suggested.email3 = header;
                            }
                        } else if (!suggested[field]) {
                            suggested[field] = header;
                        }
                        break;
                    }
                }
            });
            
            return suggested;
        }

        // ===== PROCEED TO MAPPING =====
        function proceedToMapping() {
            try {
                if (!csvHeaders || csvHeaders.length === 0) {
                    throw new Error('Headers CSV non disponibili');
                }
                
                if (csvRowCount === 0) {
                    throw new Error('Nessuna riga di dati nel CSV');
                }
                
                addLog('➡️ Passaggio al mapping delle colonne', 'info');
                showMappingSection();
                goToStep(2);
                
            } catch (error) {
                console.error('[PROCEED] Errore:', error);
                addLog('❌ Errore: ' + error.message, 'error');
                showAlert('Errore: ' + error.message, 'danger');
            }
        }

        // ===== SHOW MAPPING SECTION =====
        function showMappingSection() {
            try {
                const tbody = document.getElementById('mappingBody');
                if (!tbody) {
                    throw new Error('Elemento mappingBody non trovato');
                }
                
                tbody.innerHTML = '';
                
                addLog('🔗 Preparazione mapping colonne...', 'info');
                
                // Verifica che abbiamo i dati
                if (!csvHeaders || csvHeaders.length === 0) {
                    throw new Error('Headers CSV non disponibili!');
                }
                
                // Campi fissi del database Notion
                const notionFields = [
                    {value: '', label: '-- Non importare --'},
                    {value: 'email', label: 'Email primaria *', required: true},
                    {value: 'nome', label: 'Nome e cognome'},
                    {value: 'carica', label: 'Carica'},
                    {value: 'indirizzo', label: 'Indirizzo'},
                    {value: 'email2', label: 'Email 2'},
                    {value: 'email3', label: 'Email 3'},
                    {value: 'telefono', label: 'Telefono'},
                    {value: 'cellulare', label: 'Cellulare'},
                    {value: 'sito', label: 'Sito web'},
                    {value: 'tipo', label: 'Tipo di contatto'},
                    {value: 'comune', label: 'Comune (con correzione automatica)'}
                ];
                
                let autoMappedCount = 0;
                
                // Create mapping rows for each CSV header
                csvHeaders.forEach((header, index) => {
                    const tr = document.createElement('tr');
                    
                    // Column name
                    const tdCol = document.createElement('td');
                    tdCol.innerHTML = `<strong>${header}</strong>`;
                    tr.appendChild(tdCol);
                    
                    // Column index (for reference)
                    const tdIndex = document.createElement('td');
                    tdIndex.innerHTML = `<small style="color: var(--text-light)">Colonna ${index + 1}</small>`;
                    tr.appendChild(tdIndex);
                    
                    // Mapping select
                    const tdMapping = document.createElement('td');
                    const select = document.createElement('select');
                    select.className = 'mapping-select';
                    select.dataset.column = header;
                    
                    // Find suggested mapping
                    let suggested = '';
                    for (const [field, column] of Object.entries(currentMapping)) {
                        if (column === header) {
                            suggested = field;
                            autoMappedCount++;
                            break;
                        }
                    }
                    
                    // Add options
                    notionFields.forEach(field => {
                        const option = document.createElement('option');
                        option.value = field.value;
                        option.textContent = field.label;
                        
                        if (field.value === suggested) {
                            option.selected = true;
                            option.textContent += ' ✓';
                        }
                        
                        select.appendChild(option);
                    });
                    
                    // Update mapping on change
                    select.addEventListener('change', (e) => {
                        updateMapping(e.target.value, e.target.dataset.column);
                    });
                    
                    tdMapping.appendChild(select);
                    
                    // Highlight suggested
                    if (suggested) {
                        const badge = document.createElement('span');
                        badge.className = 'badge badge-success';
                        badge.textContent = 'Auto';
                        badge.style.marginLeft = '8px';
                        tdMapping.appendChild(badge);
                    }
                    
                    tr.appendChild(tdMapping);
                    tbody.appendChild(tr);
                });
                
                if (autoMappedCount > 0) {
                    addLog(`✅ ${autoMappedCount} colonne mappate automaticamente`, 'success');
                }
                
                // Check required fields iniziale
                checkRequiredFields();
                
            } catch (error) {
                console.error('[MAPPING] Errore:', error);
                addLog('❌ Errore mapping: ' + error.message, 'error');
            }
        }
        
        // ===== UPDATE MAPPING =====
        function updateMapping(field, column) {
            try {
                if (field) {
                    // Remove previous mapping for this field
                    for (const [f, c] of Object.entries(currentMapping)) {
                        if (f === field) delete currentMapping[f];
                    }
                    currentMapping[field] = column;
                    addLog(`✏️ Mapping: ${column} → ${field}`, 'info');
                } else {
                    // Remove mapping
                    for (const [f, c] of Object.entries(currentMapping)) {
                        if (c === column) {
                            delete currentMapping[f];
                            addLog(`❌ Mapping rimosso per: ${column}`, 'warning');
                        }
                    }
                }
                
                // Check if email is mapped
                checkRequiredFields();
                
            } catch (error) {
                console.error('[UPDATE] Errore mapping:', error);
            }
        }
        
        // ===== CHECK REQUIRED FIELDS =====
        function checkRequiredFields() {
            try {
                const emailMapped = currentMapping.email ? true : false;
                const importButton = document.getElementById('importButton');
                const emailWarning = document.getElementById('emailWarning');
                
                if (emailMapped) {
                    addLog('✅ Campo email primaria mappato', 'success');
                    if (importButton) importButton.disabled = false;
                    if (emailWarning) emailWarning.classList.add('hidden');
                } else {
                    addLog('⚠️ Email primaria è obbligatoria!', 'warning');
                    if (importButton) importButton.disabled = true;
                    if (emailWarning) emailWarning.classList.remove('hidden');
                }
                
            } catch (error) {
                console.error('[CHECK] Errore:', error);
            }
        }

        // ===== START IMPORT =====
        async function startImport() {
            try {
                if (!currentMapping.email) {
                    throw new Error('Devi mappare almeno il campo Email primaria');
                }
                
                if (!csvFullText) {
                    throw new Error('Dati CSV non disponibili');
                }
                
                addLog('🚀 Inizio importazione...', 'info');
                goToStep(3);
                
                // Reset stats
                updateStatElement('statTotal', csvRowCount);
                updateStatElement('statSuccess', '0');
                updateStatElement('statErrors', '0');
                
                importStartTime = Date.now();
                updateTimer();
                
                // Codifica CSV in base64
                const csvBase64 = btoa(unescape(encodeURIComponent(csvFullText)));
                
                const requestData = {
                    content: csvBase64,
                    mapping: currentMapping
                };
                
                console.log('[IMPORT] Invio richiesta:', requestData);
                
                const response = await fetch('http://localhost:8000/parse-and-import', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('✅ Importazione completata!', 'success');
                    showResults(result.results);
                } else {
                    throw new Error(result.error || 'Errore durante importazione');
                }
                
            } catch (error) {
                console.error('[IMPORT] Errore:', error);
                addLog('❌ Errore importazione: ' + error.message, 'error');
                showAlert('Errore importazione: ' + error.message, 'danger');
            }
        }

        // ===== SHOW RESULTS =====
        function showResults(results) {
            try {
                goToStep(4);
                
                const elapsed = Math.floor((Date.now() - importStartTime) / 1000);
                addLog(`⏱️ Tempo totale: ${elapsed} secondi`, 'info');
                
                // Remove duplicates from comuni_non_trovati
                const uniqueNotFound = [...new Set(results.comuni_non_trovati || [])];
                
                // Update stats safely
                updateStatElement('finalSuccess', results.success);
                updateStatElement('finalErrors', results.errors.length);
                updateStatElement('finalCorrected', results.comuni_corretti.length);
                updateStatElement('finalAI', results.ai_corrections ? results.ai_corrections.length : 0);
                updateStatElement('finalNotFound', uniqueNotFound.length);
                
                // Log summary
                addLog('📊 === RIEPILOGO IMPORTAZIONE ===', 'success');
                addLog(`✅ Contatti importati: ${results.success}`, 'success');
                
                if (results.errors.length > 0) {
                    addLog(`❌ Errori: ${results.errors.length}`, 'error');
                }
                
                if (results.comuni_corretti.length > 0) {
                    addLog(`🔧 Comuni corretti automaticamente: ${results.comuni_corretti.length}`, 'info');
                }
                
                if (results.ai_corrections && results.ai_corrections.length > 0) {
                    addLog(`🤖 Correzioni con AI: ${results.ai_corrections.length}`, 'success');
                }
                
                if (uniqueNotFound.length > 0) {
                    addLog(`⚠️ Comuni non trovati: ${uniqueNotFound.length}`, 'warning');
                }
                
                // Show corrections
                if (results.comuni_corretti.length > 0) {
                    showCorrectionDetails(results.comuni_corretti);
                }
                
                // Show AI corrections
                if (results.ai_corrections && results.ai_corrections.length > 0) {
                    showAICorrectionDetails(results.ai_corrections);
                }
                
                // Show not found
                if (uniqueNotFound.length > 0) {
                    showNotFoundDetails(uniqueNotFound);
                }
                
                // Show skipped contacts
                if (results.contatti_non_importati && results.contatti_non_importati.length > 0) {
                    showSkippedContactsDetails(results.contatti_non_importati);
                }
                
                // Show errors
                if (results.errors.length > 0) {
                    showErrorDetails(results.errors);
                }
                
                addLog('🎉 === IMPORTAZIONE COMPLETATA ===', 'success');
                
            } catch (error) {
                console.error('[RESULTS] Errore:', error);
            }
        }
        
        // ===== SHOW DETAILS =====
        function showCorrectionDetails(corrections) {
            try {
                const detailsEl = document.getElementById('correctionDetails');
                const listEl = document.getElementById('correctionList');
                
                if (detailsEl) detailsEl.classList.remove('hidden');
                if (listEl) {
                    listEl.innerHTML = corrections.map(c => 
                        `<div class="correction-item">
                            <span>${c.originale}</span>
                            <span class="arrow">→</span>
                            <span style="color: var(--success)">${c.corretto}</span>
                        </div>`
                    ).join('');
                }
                
                // Log some examples
                corrections.slice(0, 3).forEach(c => {
                    addLog(`  📍 ${c.originale} → ${c.corretto}`, 'info');
                });
                if (corrections.length > 3) {
                    addLog(`  ... e altri ${corrections.length - 3} comuni`, 'info');
                }
                
            } catch (error) {
                console.error('[CORRECTIONS] Errore:', error);
            }
        }
        
        function showAICorrectionDetails(aiCorrections) {
            try {
                const detailsEl = document.getElementById('aiCorrectionDetails');
                const listEl = document.getElementById('aiCorrectionList');
                
                if (detailsEl) detailsEl.classList.remove('hidden');
                if (listEl) {
                    listEl.innerHTML = aiCorrections.map(c => {
                        const metodo = c.metodo === 'email' ? 'EMAIL' : 'AI';
                        const colore = c.metodo === 'email' ? '#10b981' : '#9333ea';
                        return `<div class="correction-item" style="background: rgba(147, 51, 234, 0.03); border-left: 3px solid ${colore};">
                            <span style="color: #6b7280; font-size: 11px;">${c.timestamp}</span>
                            <span>${c.originale}</span>
                            <span class="arrow">→</span>
                            <span style="color: ${colore}; font-weight: 600;">${c.corretto}</span>
                            <span class="badge" style="background: rgba(147, 51, 234, 0.1); color: ${colore};">${metodo}</span>
                        </div>`;
                    }).join('');
                }
                
                // Log some examples
                addLog(`  🤖 === CORREZIONI AI (GPT-4o-mini) ===`, 'success');
                aiCorrections.forEach(c => {
                    addLog(`  🤖 ${c.originale} → ${c.corretto}`, 'info');
                });
                
            } catch (error) {
                console.error('[AI_CORRECTIONS] Errore:', error);
            }
        }
        
        function showNotFoundDetails(notFound) {
            try {
                const detailsEl = document.getElementById('notFoundDetails');
                const listEl = document.getElementById('notFoundList');
                
                if (detailsEl) detailsEl.classList.remove('hidden');
                if (listEl) {
                    listEl.innerHTML = notFound.map(c => 
                        `<div class="correction-item">
                            <span>${c}</span>
                            <span class="badge badge-warning">Non trovato</span>
                        </div>`
                    ).join('');
                }
                
                // Log some examples
                notFound.slice(0, 3).forEach(c => {
                    addLog(`  ⚠️ Non trovato: ${c}`, 'warning');
                });
                if (notFound.length > 3) {
                    addLog(`  ... e altri ${notFound.length - 3} comuni`, 'warning');
                }
                
            } catch (error) {
                console.error('[NOT_FOUND] Errore:', error);
            }
        }
        
        function showSkippedContactsDetails(contacts) {
            try {
                const detailsEl = document.getElementById('skippedContactsDetails');
                const headerEl = document.getElementById('skippedContactsHeader');
                const bodyEl = document.getElementById('skippedContactsBody');
                
                if (!contacts || contacts.length === 0) return;
                
                if (detailsEl) detailsEl.classList.remove('hidden');
                
                // Ottieni tutte le colonne
                const columns = new Set();
                columns.add('_row_number'); // Prima colonna: numero riga
                
                // Aggiungi le colonne dei campi mappati
                const fieldNames = {
                    'email': 'Email primaria',
                    'nome': 'Nome e cognome',
                    'carica': 'Carica',
                    'indirizzo': 'Indirizzo',
                    'email2': 'Email 2',
                    'email3': 'Email 3',
                    'telefono': 'Telefono',
                    'cellulare': 'Cellulare',
                    'sito': 'Sito web',
                    'tipo': 'Tipo contatto',
                    'comune': 'Comune'
                };
                
                Object.keys(fieldNames).forEach(field => columns.add(field));
                columns.add('_comune_non_trovato'); // Comune problematico
                columns.add('_error'); // Eventuale errore
                
                // Crea header
                if (headerEl) {
                    headerEl.innerHTML = `
                        <th style="position: sticky; top: 0; background: var(--bg);">Riga</th>
                        ${Object.entries(fieldNames).map(([field, label]) => 
                            `<th style="position: sticky; top: 0; background: var(--bg);">${label}</th>`
                        ).join('')}
                        <th style="position: sticky; top: 0; background: var(--bg);">Problema</th>
                    `;
                }
                
                // Crea righe
                if (bodyEl) {
                    bodyEl.innerHTML = contacts.map(contact => {
                        const problema = contact._comune_non_trovato ? 
                            `Comune non trovato: ${contact._comune_non_trovato}` : 
                            contact._error || 'Errore sconosciuto';
                        
                        return `<tr>
                            <td><strong>${contact._row_number || '-'}</strong></td>
                            ${Object.keys(fieldNames).map(field => 
                                `<td>${contact[field] || ''}</td>`
                            ).join('')}
                            <td style="color: var(--danger);">${problema}</td>
                        </tr>`;
                    }).join('');
                }
                
                // Salva i dati per l'export
                window.skippedContactsData = contacts;
                
                addLog(`📋 ${contacts.length} contatti non importati (dettaglio disponibile)`, 'warning');
                
            } catch (error) {
                console.error('[SKIPPED_CONTACTS] Errore:', error);
            }
        }
        
        function exportSkippedContacts() {
            try {
                if (!window.skippedContactsData || window.skippedContactsData.length === 0) {
                    showAlert('Nessun contatto da esportare', 'warning');
                    return;
                }
                
                // Crea CSV
                const headers = ['Riga', 'Email primaria', 'Nome e cognome', 'Carica', 'Indirizzo', 
                                'Email 2', 'Email 3', 'Telefono', 'Cellulare', 'Sito web', 'Tipo contatto', 
                                'Comune', 'Problema'];
                
                const csvContent = [
                    headers.join(','),
                    ...window.skippedContactsData.map(contact => {
                        const problema = contact._comune_non_trovato ? 
                            `Comune non trovato: ${contact._comune_non_trovato}` : 
                            contact._error || 'Errore sconosciuto';
                        
                        return [
                            contact._row_number || '',
                            contact.email || '',
                            contact.nome || '',
                            contact.carica || '',
                            contact.indirizzo || '',
                            contact.email2 || '',
                            contact.email3 || '',
                            contact.telefono || '',
                            contact.cellulare || '',
                            contact.sito || '',
                            contact.tipo || '',
                            contact.comune || '',
                            `"${problema}"`
                        ].join(',');
                    })
                ].join('\n');
                
                // Download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `contatti_non_importati_${new Date().toISOString().slice(0,10)}.csv`;
                link.click();
                
                addLog('📥 CSV contatti non importati scaricato', 'success');
                
            } catch (error) {
                console.error('[EXPORT] Errore:', error);
                showAlert('Errore durante export: ' + error.message, 'danger');
            }
        }
        
        function showErrorDetails(errors) {
            try {
                const detailsEl = document.getElementById('errorDetails');
                const tbodyEl = document.getElementById('errorList');
                
                if (detailsEl) detailsEl.classList.remove('hidden');
                if (tbodyEl) {
                    tbodyEl.innerHTML = errors.map(e => 
                        `<tr>
                            <td>${e.row}</td>
                            <td>${e.error}</td>
                        </tr>`
                    ).join('');
                }
                
                // Log first error
                if (errors.length > 0) {
                    addLog(`  ❌ Esempio errore riga ${errors[0].row}: ${errors[0].error}`, 'error');
                }
                
            } catch (error) {
                console.error('[ERRORS] Errore:', error);
            }
        }

        // ===== NAVIGATION =====
        function goToStep(stepNum) {
            try {
                // Hide all sections
                ['uploadSection', 'mappingSection', 'importSection', 'resultsSection'].forEach(id => {
                    const section = document.getElementById(id);
                    if (section) section.classList.add('hidden');
                });
                
                // Show current section
                const sections = ['', 'uploadSection', 'mappingSection', 'importSection', 'resultsSection'];
                if (sections[stepNum]) {
                    const currentSection = document.getElementById(sections[stepNum]);
                    if (currentSection) currentSection.classList.remove('hidden');
                }
                
                // Update step indicator
                document.querySelectorAll('.step').forEach((step, index) => {
                    step.classList.remove('active', 'completed');
                    if (index + 1 < stepNum) {
                        step.classList.add('completed');
                    } else if (index + 1 === stepNum) {
                        step.classList.add('active');
                    }
                });
                
            } catch (error) {
                console.error('[NAV] Errore:', error);
            }
        }

        // ===== RESET =====
        function resetUpload() {
            try {
                const fileInput = document.getElementById('fileInput');
                const fileInfo = document.getElementById('fileInfo');
                const uploadArea = document.getElementById('uploadArea');
                const parseSection = document.getElementById('parseSection');
                const mainLog = document.getElementById('mainLogContainer');
                
                if (fileInput) fileInput.value = '';
                if (fileInfo) fileInfo.classList.add('hidden');
                if (uploadArea) uploadArea.classList.remove('hidden');
                if (parseSection) parseSection.classList.add('hidden');
                if (mainLog) mainLog.innerHTML = '';
                
                csvFullText = null;
                csvHeaders = [];
                csvRowCount = 0;
                currentMapping = {};
                
                addLog('🔄 Reset completato, pronto per nuovo file', 'info');
                
            } catch (error) {
                console.error('[RESET] Errore:', error);
            }
        }

        // ===== TIMER =====
        function updateTimer() {
            try {
                if (!importStartTime) return;
                
                const elapsed = Math.floor((Date.now() - importStartTime) / 1000);
                updateStatElement('statTime', elapsed + 's');
                
                const importSection = document.getElementById('importSection');
                if (importSection && !importSection.classList.contains('hidden')) {
                    setTimeout(updateTimer, 1000);
                }
                
            } catch (error) {
                console.error('[TIMER] Errore:', error);
            }
        }

        // ===== LOGGING =====
        function addLog(message, type = 'info') {
            try {
                // Log nel container principale se visibile
                const mainContainer = document.getElementById('mainLogContainer');
                if (mainContainer && !document.getElementById('uploadSection')?.classList.contains('hidden')) {
                    appendLogEntry(mainContainer, message, type);
                }
                
                // Log anche nel container di import se visibile
                const importContainer = document.getElementById('logContainer');
                if (importContainer && !document.getElementById('importSection')?.classList.contains('hidden')) {
                    appendLogEntry(importContainer, message, type);
                }
                
                // Console log sempre
                console.log(`[${type.toUpperCase()}] ${message}`);
                
            } catch (error) {
                console.error('[LOG] Errore:', error);
            }
        }
        
        function appendLogEntry(container, message, type) {
            try {
                if (!container) return;
                
                const time = new Date().toLocaleTimeString();
                
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                
                let icon = '';
                let className = '';
                
                switch(type) {
                    case 'success':
                        icon = '✓';
                        className = 'log-success';
                        break;
                    case 'error':
                        icon = '✗';
                        className = 'log-error';
                        break;
                    case 'warning':
                        icon = '⚠';
                        className = 'log-warning';
                        break;
                    default:
                        icon = 'ℹ';
                }
                
                entry.innerHTML = `
                    <span class="log-time">[${time}]</span>
                    <span class="${className}">${icon} ${message}</span>
                `;
                
                container.appendChild(entry);
                container.scrollTop = container.scrollHeight;
                
            } catch (error) {
                console.error('[LOG_ENTRY] Errore:', error);
            }
        }

        // ===== UTILITY FUNCTIONS =====
        function showAlert(message, type = 'info') {
            try {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.textContent = message;
                alertDiv.style.position = 'fixed';
                alertDiv.style.top = '20px';
                alertDiv.style.right = '20px';
                alertDiv.style.zIndex = '9999';
                alertDiv.style.minWidth = '300px';
                
                document.body.appendChild(alertDiv);
                
                setTimeout(() => {
                    if (alertDiv.parentNode) {
                        alertDiv.parentNode.removeChild(alertDiv);
                    }
                }, 5000);
                
            } catch (error) {
                console.error('[ALERT] Errore:', error);
            }
        }

        function formatFileSize(bytes) {
            try {
                if (bytes < 1024) return bytes + ' B';
                if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
                return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
            } catch (error) {
                return 'N/A';
            }
        }
        
        function updateStatElement(id, value) {
            try {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            } catch (error) {
                console.error('[STAT] Errore aggiornamento:', error);
            }
        }
    </script>
</body>
</html>